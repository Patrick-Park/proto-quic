--- net/url_request/url_request_http_job_unittest.cc
+++ net/url_request/url_request_http_job_unittest.cc
@@ -25,6 +25,7 @@
 #include "net/log/test_net_log.h"
 #include "net/log/test_net_log_entry.h"
 #include "net/log/test_net_log_util.h"
+#include "net/net_features.h"
 #include "net/socket/socket_test_util.h"
 #include "net/test/cert_test_util.h"
 #include "net/test/gtest_util.h"
@@ -707,12 +708,12 @@
     {"http://upgrade.test:123/", true, "https://upgrade.test:123/"},
     {"http://no-upgrade.test/", false, "http://no-upgrade.test/"},
     {"http://no-upgrade.test:123/", false, "http://no-upgrade.test:123/"},
-#if defined(ENABLE_WEBSOCKETS)
+#if BUILDFLAG(ENABLE_WEBSOCKETS)
     {"ws://upgrade.test/", true, "wss://upgrade.test/"},
     {"ws://upgrade.test:123/", true, "wss://upgrade.test:123/"},
     {"ws://no-upgrade.test/", false, "ws://no-upgrade.test/"},
     {"ws://no-upgrade.test:123/", false, "ws://no-upgrade.test:123/"},
-#endif  // defined(ENABLE_WEBSOCKETS)
+#endif  // BUILDFLAG(ENABLE_WEBSOCKETS)
   };
 
   for (const auto& test : cases) {
@@ -953,7 +954,7 @@
                                              bool));
 };
 
-#if defined(ENABLE_WEBSOCKETS)
+#if BUILDFLAG(ENABLE_WEBSOCKETS)
 
 class FakeWebSocketHandshakeStream : public WebSocketHandshakeStreamBase {
  public:
@@ -1058,7 +1059,7 @@
   EXPECT_TRUE(fake_handshake_stream->initialize_stream_was_called());
 }
 
-#endif  // defined(ENABLE_WEBSOCKETS)
+#endif  // BUILDFLAG(ENABLE_WEBSOCKETS)
 
 }  // namespace
 
